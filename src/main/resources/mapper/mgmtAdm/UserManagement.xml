<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.teamb.btob.mapper.mgmtAdm.UserMgmtAdmMapper">

	<sql id="searchCondi">
	
		AND ( 
			        a.user_id LIKE CONCAT('%', #{searchCondition}, '%') 
			        OR a.user_nm LIKE CONCAT('%', #{searchCondition}, '%') 
					OR b.company_name LIKE CONCAT ('%', #{searchCondition}, '%' ) 
					OR c.comm_name LIKE CONCAT ('%', #{searchCondition}, '%') 
				)
				
	</sql>


	<!-- 사용자관리 검색 조회 -->
	<select id=""
		parameterType="java.util.Map"
		resultType="io.github.teamb.btob.dto.mgmtAdm.user.SearchConditionUserDTO">

			SELECT
				 a.user_no
				,a.user_id
				,a.user_nm
				,b.company_name
				,a.user_type
				,a.app_status
				,a.acc_status
				,a.reg_dtime
				,a.upd_dtime
			FROM 
				TB_USERS a,
				TB_COMPANIES b
			WHERE 1=1
			AND a.company_cd = b.company_cd
			<if test="searchCondition != null and searchCondition.trim() != ''">
			    <include refid="searchCondi" />
			</if>
			ORDER BY a.user_no DESC
			LIMIT #{startRow}, #{limit}
	
	</select>
	
	<!-- 사용자 관리 검색 조회 건수  -->
	<select id=""
		parameterType="String"
		resultType="int">

			SELECT
				COUNT(a.user_no)
			FROM
				TB_USERS a,
				TB_COMPANIES b
			WHERE 1=1
			AND a.company_cd = b.company_cd
			<if test="searchCondition != null and searchCondition.trim() != ''">
			    <include refid="searchCondi" />
			</if>
		
	</select>
	
	<!-- 사용자 관리 상세 정보 -->
	<select id=""
		parameterType="int"
		resultType="io.github.teamb.btob.dto.mgmtAdm.user.SearchDetailInfoUserDTO">
	
			SELECT
				a.user_no,
				a.user_id,
				a.user_nm,
				a.phone,
				a.email,
				b.company_name,
				b.company_phone,
				b.addr_kor,
				b.addr_eng,
				b.zip_code,
				b.biz_number,
				b.customs_num,
				a.user_type,
				a.app_status,
				a.acc_status,
				a.reg_dtime,
				a.upd_dtime,
				a.use_yn			 
			FROM
				TB_USERS a,
				TB_COMPANIES b
			WHERE 1=1
			AND a.company_cd = b.company_cd 
			AND a.user_no = #{userNo}
	
	</select>

</mapper>
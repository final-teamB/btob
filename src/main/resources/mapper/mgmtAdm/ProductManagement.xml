<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.teamb.btob.mapper.productmgmt.ProductMgmtAdmMapper">

	<sql id="oilMstJoins">
	
	    INNER JOIN TB_OIL_MST_DETAIL e ON a.fuel_id = e.fuel_id
				LEFT OUTER JOIN COMMON_TBL b ON 
					a.fuel_cat_cd = b.comm_no 
					AND b.param3_value = 'FUEL_CAT'
				LEFT OUTER JOIN COMMON_TBL c ON 
					a.origin_cntry_cd = c.comm_no 
					AND c.param3_value = 'COUNTRY'
				LEFT OUTER JOIN COMMON_TBL d ON 
					a.vol_unit_cd = d.comm_no 
					AND d.param3_value = 'UNIT'
				LEFT OUTER JOIN COMMON_TBL f ON 
					a.item_stts_cd = f.comm_no 
					AND f.param3_value = 'ITEM_STTS'
					
	</sql>
	
	<sql id="searchCondi">
	
		AND ( 
			        a.fuel_cd LIKE CONCAT('%', #{searchCondition}, '%')
			        OR a.fuel_nm LIKE CONCAT('%', #{searchCondition}, '%')
					OR b.comm_name LIKE CONCAT ('%', #{searchCondition}, '%' )
					OR c.comm_name LIKE CONCAT ('%', #{searchCondition}, '%')
				)
				
	</sql>


	<!-- 조회 -->
	<select id="selectOilMstListAdm"
		parameterType="java.util.Map"
		resultType="io.github.teamb.btob.dto.productmgmt.ProductMgmtAdmDTO">
	
			SELECT
				ROW_NUMBER() OVER (ORDER BY a.reg_dtime ASC) AS rownm
				,a.fuel_id
				,a.fuel_cd
				,a.fuel_nm
				,a.fuel_cat_cd
				,b.comm_name AS fuel_cat_nm       /* 유류종류 명칭 */
				,a.origin_cntry_cd
				,c.comm_name AS origin_cntry_nm   /* 원산지 국가 명칭 */
				,a.base_unit_prc
				,a.curr_stock_vol
				,a.safe_stock_vol
				,a.vol_unit_cd
				,d.comm_name AS vol_unit_nm       /* 유류단위 명칭 */
				,a.item_stts_cd
				,f.comm_name AS item_stts_nm      /* 재고상태 명칭 */
				,a.reg_dtime
				,a.reg_id
				,a.upd_dtime
				,a.upd_id
				,a.use_yn
				,e.api_grv
				,e.sulfur_p_cnt
				,e.flash_pnt
				,e.viscosity
				,e.density_15c
			FROM
				TB_OIL_MST a
			<include refid="oilMstJoins" />
			WHERE 1 = 1
			<if test="searchCondition != null and searchCondition.trim() != ''">
		       <include refid="searchCondi" />
		    </if>
		    ORDER BY ROW_NUMBER() OVER (ORDER BY a.reg_dtime ASC) DESC
			LIMIT #{startRow}, #{limit}
			
	</select>
	
	<!-- 조회 건수 -->
	<select id="countOilMstListCntAdm" 
		parameterType="String"
		resultType="int">
		
			SELECT 
				COUNT(a.fuel_id)
			FROM
				TB_OIL_MST a
			<include refid="oilMstJoins" />
			WHERE 1 = 1
			<if test="searchCondition != null and searchCondition.trim() != ''">
			    <include refid="searchCondi" />
			</if>
	
	</select>
	
	<!-- 상세조회 -->
	<select id="selectOilMstInfoByIdAdm"
		parameterType="int"
		resultType="io.github.teamb.btob.dto.productmgmt.ProductMgmtAdmDTO">
	
			SELECT
					,a.fuel_id
					,a.fuel_nm
					,b.fuel_cat_nm
					,c.origin_cntry_nm
					,e.api_grv
					,e.sulfur_p_cnt
					,e.flash_pnt
					,e.viscosity
					,e.density_15c
					,a.base_unit_prc
					,a.curr_stock_vol
					,a.safe_stock_vol
					,d.vol_unit_nm
					,f.item_stts_nm
					,a.reg_dtime
					,a.reg_id
					,a.upd_dtime
					,a.upd_id
					,a.use_yn
				FROM
					TB_OIL_MST a
				<include refid="oilMstJoins" />
				WHERE 1 = 1
					AND a.use_yn = 'Y'
					AND a.fuel_id = #{fuelId}
	
	</select>
	
	<!-- 등록 -->
	<insert id="insertOilMstProductAdm"
		parameterType="io.github.teamb.btob.dto.productmgmt.ProductMgmtAdmDTO">
		
			INSERT INTO TB_OIL_MST (
					fuel_cd
					,fuel_nm
					,fuel_cat_cd
					,origin_cntry_cd
					,base_unit_prc
					,curr_stock_vol
					,safe_stock_vol
					,vol_unit_cd
					,item_stts_cd
					,reg_id
				) VALUES (
					 #{fuelCd}
					,#{fuelNm}
					,#{fuelCatCd}
					,#{originCntryCd}
					,#{baseUnitPrc}
					,#{currStockVol}
					,#{safeStockVol}
					,#{volUnitCd}
					,#{itemSttsCd}
					,#{regId}
				)
	
	</insert>
	
	<!-- 등록 -->
	<insert id="insertOilMstDetailProductAdm"
		parameterType="io.github.teamb.btob.dto.productmgmt.ProductMgmtAdmDTO">
		
			INSERT INTO TB_OIL_MST_DETAIL (
					,fuel_id
					,api_grv
					,sulfur_p_cnt
					,flash_pnt
					,viscosity
					,density_15c
					,reg_id
				) VALUES (
					 #{fuelId}
					,#{apiGrv}
					,#{sulfurPCnt}
					,#{flashPnt}
					,#{viscosity}
					,#{density15c}
					,#{regId}
				)    
					
	</insert>
	
	<!-- 수정 -->
	<update id="updateOilMstProductAdm"
		parameterType="io.github.teamb.btob.dto.productmgmt.ProductMgmtAdmDTO">
	
			UPDATE 
		        TB_OIL_MST
		    SET
		        fuel_cd          = #{fuelCd},
		        fuel_nm          = #{fuelNm},
		        fuel_cat_cd      = #{fuelCatCd},
		        origin_cntry_cd  = #{originCntryCd},
		        base_unit_prc    = #{baseUnitPrc},
		        curr_stock_vol   = #{currStockVol},
		        safe_stock_vol   = #{safeStockVol},
		        vol_unit_cd      = #{volUnitCd},
		        item_stts_cd     = #{itemSttsCd},
		        use_yn           = #{useYn},
		        upd_dtime        = CURRENT_TIMESTAMP,
		        upd_id           = #{updId}
		    WHERE 
		        fuel_id = #{fuelId}
			
	</update>
	
	<!-- 수정 -->
	<update id="updateOilMstDetailProductAdm"
		parameterType="io.github.teamb.btob.dto.productmgmt.ProductMgmtAdmDTO">
		
			UPDATE 
		        TB_OIL_MST_DETAIL
		    SET
		        api_grv         = #{apiGrv},         
		        sulfur_p_cnt    = #{sulfurPCnt},     
		        flash_pnt       = #{flashPnt},       
		        viscosity       = #{viscosity},      
		        density_15c     = #{density15c},     
		        use_yn          = #{useYn},
		        upd_dtime       = CURRENT_TIMESTAMP,
		        upd_id          = #{updId}
		    WHERE 
		    	fuel_id = #{fuelId}
		
	</update>
	
	<!-- 미사용처리 -->
	<update id="deleteOilMstProductByIdAdm"
		parameterType="int">
		
			UPDATE
				TB_OIL_MST
			SET
				use_yn          = #{useYn},
		        upd_dtime       = CURRENT_TIMESTAMP,
		        upd_id          = #{updId}
		    WHERE 
		    	fuel_id = #{fuelId}
		    	 
	</update>
	
	<!-- 미사용처리 -->
	<update id="deleteOilMstDetailProductByIdAdm"
		parameterType="int">
	
			UPDATE
				TB_OIL_MST_DETAIL
			SET
				use_yn          = #{useYn},
		        upd_dtime       = CURRENT_TIMESTAMP,
		        upd_id          = #{updId}
		    WHERE 
		    	fuel_id = #{fuelId}
		    	
	</update>
	
</mapper>